#cloud-config
# https://ubuntu.com/server/docs/install/autoinstall

# https://ubuntu.com/server/docs/install/autoinstall-reference#locale
locale: en_US.utf8

# https://ubuntu.com/server/docs/install/autoinstall-reference#keyboard
keyboard:
  layout: "us"
  variant: ""

# https://ubuntu.com/server/docs/install/autoinstall-reference#reporting
reporting:
  builtin:
    type: print

packages:
  - openssh-server

# = Runcmd =
# Run commands on first boot
runcmd:
  - rm -f /etc/resolv.conf
  - ln -s ../run/systemd/resolve/stub-resolv.conf /etc/resolv.conf
# = Timezone =
timezone: UTC
# = Set Hostname/Update Hostname =
preserve_hostname: false
prefer_fqdn_over_hostname: true
fqdn: test.local
hostname: test
# = Update Etc Hosts =
manage_etc_hosts: true
ssh:
  install-server: true
  allow-pw: true
  {% if managementSSHKey or (userSSHKeys and (userSSHKeys | length)) -%}
  authorized_keys:
    {%- if userSSHKeys and (userSSHKeys | length) %}
    {%- for sshKey in userSSHKeys %}
      - {{ sshKey.sshKey }}
    {%- endfor %}
    {%- endif %}
    {%- if managementSSHKey %}
      - {{ managementSSHKey }}
    {%- endif %}
    {%- endif %}
# = Set Passwords =
ssh_pwauth: true
password: Setup00!
chpasswd: { expire: false }
# = Users and Groups =
users:
  - default
  - name: root
    lock_passwd: false
    plain_text_passwd: Setup00!
    {% if managementSSHKey or (userSSHKeys and (userSSHKeys | length)) -%}
    ssh_authorized_keys:
    {%- if userSSHKeys and (userSSHKeys | length) %}
    {%- for sshKey in userSSHKeys %}
      - {{ sshKey.sshKey }}
    {%- endfor %}
    {%- endif %}
    {%- if managementSSHKey %}
      - {{ managementSSHKey }}
    {%- endif %}
    {%- endif %}
# = Growpart =
growpart:
  mode: auto
  devices: ['/']
  ignore_growroot_disabled: false
# = SSH =
ssh_deletekeys: true
ssh_genkeytypes: [rsa]
disable_root: false
allow_public_ssh_keys: true
# SSH Authkey Fingerprints
no_ssh_fingerprints: true
authkey_hash: sha256
# = Keys to Console =
ssh:
  emit_keys_to_console: true
# = Package Update Upgrade Install =
package_update: false
package_upgrade: false
package_reboot_if_required: false
# = Final Message =
final_message: Cloud-init Done!
