[global]
keyboard = "en-us"
country = "us"
{%- if serverInstance and serverInstance.fqdn %}
  fqdn = "{{serverInstance.fqdn}}"
{%- else %}
  fqdn = "{{serverInstance.label}}.domain"
{%- endif %}

mailto = "mail@no.invalid"
timezone = "America/Chicago"
root_password = "{{serverInstance.osCredentials.initialPasswordEncrypted}}"

[network]
source = "from-answer"

{%- set interface_physical = [] %}
{%- set interface_bond = [] %}
{%- set interface_vlan = [] %}
{%- if network and network.interfaces %}
{%- for interface in network.interfaces %}
  {%- if interface.interfaceType == 'physical' %}
    {%- set interface_physical = (interface_physical.push(interface), interface_physical) %}
  {%- elif interface.interfaceType == 'bond' %}
    {%- set interface_bond = (interface_bond.push(interface), interface_bond) %}
  {%- elif interface.interfaceType == 'vlan' %}
    {%- set interface_vlan = (interface_vlan.push(interface), interface_vlan) %}
  {%- endif %}
{%- endfor %}
{%- endif %}
{%- set interface_configured = false %}
{%- for interface in interface_physical %}
  {%- if not interface_configured %}
  {%- set is_bond_slave = false %}
  {%- for bond in interface_bond %}
    {%- if bond.members %}
      {%- for member in bond.members %}
        {%- if interface.typeInterfaceId == member.id %}
          {%- set is_bond_slave = true %}
        {%- endif %}
      {%- endfor %}
    {%- endif %}
  {%- endfor %}        
  {%- if is_bond_slave %}             
  {%- else %}
  
{%- if interface.ipv4Addresses | length > 0 %}
cidr="{{interface.ipv4Addresses[0].cidr | default('192.168.1.100/24')}}"
{%- if interface.routes and interface.routes | length > 0 and interface.routes[0].via %}
gateway="{{interface.routes[0].via}}"
{%- endif %}
{%- elif interface.ipv6Addresses | length > 0 %}
cidr="{{interface.ipv6Addresses[0].cidr}}"
{%- if interface.ipv6Addresses[0].gateway %}
gateway="{{interface.ipv6Addresses[0].gateway}}"
{%- endif %}
{%- else %}
cidr="192.168.1.100/24"
{%- endif %}
filter.ID_NET_NAME_MAC = "*{{ interface.macAddress | replace(":", "") | lower }}"
{%- set interface_configured = true %}

  {%- endif %}
  {%- endif %}
{%- endfor %}

{%- if siteConfig and siteConfig.DNSServers and siteConfig.DNSServers | length > 0 %}
dns = "{{siteConfig.DNSServers[0]}}"
{%- else %}
dns = "8.8.8.8"
{%- endif %}

[disk-setup]
filesystem = "ext4"
lvm.swapsize = 0
lvm.maxvz = 0
disk_list = ['sda']

[first-boot]
source = "from-iso"
ordering = "before-network"

